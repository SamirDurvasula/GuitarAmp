<!DOCTYPE HTML>
<html>
	<head>
		<title>ECE 4760: Bluetooth-Controlled Guitar Amp</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<!--[if lte IE 8]><script src="assets/js/ie/html5shiv.js"></script><![endif]-->
		<link rel="stylesheet" href="assets/css/main.css" />
		<!--[if lte IE 8]><link rel="stylesheet" href="assets/css/ie8.css" /><![endif]-->
	</head>
	<body>

		<!-- Header -->
			<section id="header">
				<header>
					<span class="image avatar"><img src="images/avatar.jpg" alt="" /></span>
					<h1 id="logo">FX Guitar Amp</h1>
					<p>We had a guitar but no amp...<br />
					so we decided to make one.</p>
				</header>
				<nav id="nav">
					<ul>
						<li><a href="#two">High-level Design</a></li>
						<li><a href="#three">Hardware/Program Details</a></li>
						<li><a href="#four">Results</a></li>
						<li><a href="#five">Conclusions</a></li>
						<li><a href="#six">Appendix</a></li>
					</ul>
				</nav>
				<footer>
					<!--ul class="icons">
						<li><a href="https://github.com/JustinSelig/BluetoothGuitarAmp" class="icon fa-github"><span class="label">Github</span></a></li>
						<li><a href="mailto:jss459@cornell.edu?Subject=ECE 4760%20Guitar%20Amp" class="icon fa-envelope"><span class="label">Email</span></a></li>
					</ul-->
				</footer>
			</section>

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Main -->
					<div id="main">
						
						<!-- One: Overview -->
							<section id="one">
								<div class="container">
									<header class="major">
										<h2>Bluetooth-Controlled Guitar FX Amplifier</h2>
										<p>Justin Selig <br/>Samir Durvasula <br/>Adarsh Jayakumar <br/>
										</p>
									</header>
									<p>As part of our final project for ECE 4760: Digital Systems Design Using Microcontrollers, we built a guitar amplifier with remote distortion and digital effects capabilities controlled from a smartphone via bluetooth. <br/><br/>Musicians often need to modify the configuration of their amplifiers when performing in concerts. This job is generally delegated to "roadies" who walk on-stage between sets to make adjustments. By building on top of generic amplifier <a href="#three">circuitry</a> we've been able to increase the capabilities of the standard guitar amp to allow remote control over all aspects of the amplifier's sound.</p>
								</div>
							</section>

						<!-- Two: High Level Design -->
							<section id="two">
								<div class="container">
									<h3>High-Level Design</h3>
									<h5>Things I Can Do</h5>
									<ul class="feature-icons">
										<li class="fa-wifi">Interface via bluetooth with smartphone</li>
										<li class="fa-cubes">Perform <a>Digital Effects</a></li>
										<li class="fa-book">Modify bass, treble, and mid with physical knobs</li>
										<li class="fa-book">Modify bass, treble, and mid digitally</li>
										
									</ul>
										
										<h5>Details</h5>
									<p><span class="image left"><img src="images/HardwareBlockDiagram.png" width=400px alt="" /></span>There are two methods of interfacing with the amplifier. The first  resembles a classic guitar amplifier where the user controls the analog effects via knobs connected to analog potentiometers. As is standard, the input of the amplifier comes from a ¼” TS Male Auxiliary cord attached to an electric or acoustic guitar. We have a ¼” TS female to 3.5 mm TRS male adaptor. This in turn connects to a 3.5 mm adaptor which is wired directly into our circuit.<br/>The second style of interfacing with the amplifier is via the PIC32 microcontroller which controls and applies digital effects. These sound effects are outputs of a Belton BTSE-16 chip, which, through onboard DSP, synthesize various effects. These effects include chorus, flanger, phaser, tremolo, delay, reverb, and various combinations thereof. </p>
									<p><span class="image left"><img src="images/HardwareBlockDiagram.png" width=400px alt="" /></span>There are two methods of interfacing with the amplifier. The first resembles a classic guitar amplifier where the user controls the analog effects via knobs connected to analog potentiometers. As is standard, the input of the amplifier comes from a ¼” TS Male Auxiliary cord attached to an electric or acoustic guitar. We have a ¼” TS female to 3.5 mm TRS male adaptor. This in turn connects to a 3.5 mm adaptor which is wired directly into our circuit.<br/>The second style of interfacing with the amplifier is via the PIC32 microcontroller which controls and applies digital effects. These sound effects are outputs of a Belton BTSE-16 chip, which, through onboard DSP, synthesize various effects. These effects include chorus, flanger, phaser, tremolo, delay, reverb, and various combinations thereof. </p>
									<p><span class="image right"><img src="images/bluetooth.png" height=300px alt="" /></span>As part of our ‘stretch goal’, the primary standard to which we've conformed is determined by the Bluetooth Special Interest Group (SIG). The standard for Bluetooth that we will be following is set by IEEE 802.15.1. The standard essentially sets the MAC addresses available for our use as well as limits our applications to the 2.4-2.485 GHz ISM band. </p>
								</div>
						</section>
									
						<!-- Three: Detailed Design -->
						<section id="three">
							<div class="container">
									<h3>Analog Circuitry</h3>
									<p>A large portion of the project was devoted to building and testing standard analog circuitry for generating our desired effects. The schematics for these are included below.</p>
									<div class="features">
										<article>
											<a href="http://www.instructables.com/id/Very-simple-and-cheap-GuitarBass-distortion-pedal/" class="image"><img src="images/distortion.jpg" alt="" /></a>
											<div class="inner">
												<h4>Distortion</h4>
												<p>Our input goes through a common emitter amplifier with the 10k and 100k resistors deciding the gain of the circuit. The 100 nF and 10 uF capacitors decide the frequency response of the circuit with a lower input capacitance creating a more treble-heavy sound and a higher input capacitance creating a more bass-heavy sound. The schottky diodes act as clipping diodes creating the distorted sound we hear at the output.</p>
											</div>
										</article>
										<article>
											<a href="http://www.runoffgroove.com/tonemender.html" class="image"><img src="images/tonestack.png" alt="" /></a>
											<div class="inner">
												<h4>Tone Stack</h4>
												<p>Our input goes through a high pass filter into a unity gain op amp (pins 1,2, and 3). The treble potentiometer adjusts a high-pass filter that sets the cutoff frequency below which no frequencies can pass. The bass potentiometer adjusts a low-pass filter that sets the cutoff frequency above which no frequencies can pass. The mid potentiometer acts as a band-pass filter that amplifies the center frequency about which treble and bass act. The level potentiometer changes the magnitude of the output signal by altering the gain of the second op-amp (pins 5, 6, and 7). Pins 4 and 8 are the ground and Vdd (8.84 Volts) of the op-amp respectively.</p>
											</div>
										</article>
										<article>
											<a href="http://www.ti.com/lit/ds/symlink/tpa3122d2.pdf" class="image"><img src="images/classdamp.png" alt="" /></a>
											<div class="inner">
												<h4>Class-D Amplifier</h4>
												<p>We used a TPA3122D2 15 Watt Class-D power amplifier in order to drive the signal to our speakers. The class-D amplifier uses pulse width modulation to take our analog input signal, convert it into pulses, and amplify the signal. The amplified pulse train is converted back into an analog signal with the passive low-pass filter (capacitor and inductor) out of the BSR and ROUT pins of the chip (pins 12 and 13). Finally, we add DC offset to our signal with our 470 uF capacitor in order to output a hearable signal to our speakers.</p>
											</div>
										</article>
									</div>
								</div>
								<div class="container">
									<h3>Digital Circuitry and Microcontroller Integration</h3>
									<p>An even greater portion of the project was dedicated to digital design and microcontroller programming...</p>
									<div class="features">
										<article>
											<a href="http://www.accutronicsreverb.com/main/?skin=sub01_07.html" class="image">
												<img src="images/BTSE-16FX_img.jpg" alt="" />Digital Sound Effector Chip
												<img src="images/BTSE16FX_01.gif" />Wiring Schematic
												<img src="images/digital_effects_list.png"/>16 Digital Effects Control With 4-Bit Signal
											</a>
											<div class="inner">
												<h4>Digital Effects Chip</h4>
												<p>The BTSE-16FX effect board provides 16 different digital audio effects when integrated into the amp. On the highest level, the chip takes in an input signal (sound wave), a 4-bit binary select signal, and outputs an affected signal. The schematic shown to the left demonstrates one way to set up the chip which involves stepping down a voltage to power the chip, filtering an input signal, and filtering the output signal. We modified this schematic by replacing the input voltage circuit with a simple 5-volt power supply, replacing the input filtering with a simple high-pass filter, and removing the output circuit entirely by operating directly on the output of the chip.<br/><br/>The 4-bit binary select signal for choosing an effect was generated directly off the Pic32. A user would make a choice for effect via his or her smartphone, and the resulting bluetooth signal is read via uart and translated to a 4-bit logic output.</p>
											</div>
										</article>
										<article>
											<a href="http://www.gearbest.com/other-accessories/pp_227678.html" class="image"><img src="images/hc05.jpg" alt="" /></a>
											<div class="inner">
												<h4>HC-05 Bluetooth Module</h4>
												<p>The HC-05 bluetooth module handles almost all responsibilities associated with establishing a bluetooth connection with any other bluetooth-enabled device. The HC-05 communicates over UART with the PIC which both transmits and received data. The chip works by publishing a bluetooth service and allowing another client - the smartphone - to pair with the module. Through the use of a bluetooth terminal on a smartphone (eg. blu-term) one can send data and test the uart connection with the PIC. </p>
											</div>
										</article>
										<article>
											<a href="http://www.microchip.com/wwwproducts/Devices.aspx?product=PIC32MX250F128B" class="image"><img src="images/pic32.png" alt="" /><img src="images/OverallSchematic.png" width=400px alt="" />Overall Schematic of Project</a>
									<div class="inner">
												<h4>Pic32 Microcontroller</h4>
												<p>The Pic32 is a class of 32-bit microcontrollers manufactured by Microchip. It was used as the main control center for the guitar amplifier. Its integration into the project can be seen in the left hand schematic describing how the overall projct was wired. Using UART, it was able to communicate with a smartphone using bluetooth. Then, using various pins as digital output, it selcted various multiplexer signals as necessary, as well as the correct outputs to the speaker. In addition, using SPI, the microcontroller was used to control various 100K digital potentiometers. As a result, it was crucial to use the PIC in the project, as otherwise integration would not have been possible </p>
											</div>
										</article>
									</div>
									<div>
										
									<h3>Code Details</h3>
									Talk about code here.
									</div>
									
								</div>
							</section>
						
						<!-- Four -->
							<section id="four">
								<div class="container">
										<h3>Results</h3>
                                    <h5>Bluetooth</h5>
                                    <p>Using the HC-05 chip, bluetooth was used to control all aspects of the other circuits built for the project. USing a UART interface, bluetooth was very effective in controlling the amplifier. It was implemented using the protothreads DMA UART libraries. In the interest of time, we did not develop a front end for the bluetooth, however, using a bluetooth terminal on an Android device instead. Future work would involve building a fully functional front end to the amplifier. </p>
                                        <h5> Distortion</h5>
                                        <p> Our goal for the distortion portion of the circuit was to take our input signal through a raw distorted effect and output it through our class-D amplifier to our speakers. FIGURE BLANK (PUT DISTORTION PICTURE) presents the 'clipped' signal that is outputted from the distortion circuit. Our final distortion circuit was protoboarded and presented with the distortion effect being clearly heard through our speakers. </p>
										<h5> Tonestack </h5>
										<p> Our primary goal for the tonestack was to implement both analog potentiometers as well as digital potentiometers that could control the bass, mid, treble, and level functionalities of our guitar amplifier. The 100 kilaohm digital potentiometers wwould be controlled via smartphone through our HC-05 Bluetooth module and PIC32 microcontroller while the analog potentiometers would be controlled via physical tunable knobs on the guitar amplifier. 
                                            <p>The analog portion of the tonestack was successfully wired on a breadboard and soldered onto a protoboard. The  values chosen were 250 kilaohms for the bass/treble potentiometers and 100 kilaohms for the level/mid potentiometers. The effects themselves worked very well both on an oscilloscope as well as through our Class-D amplifier. Figures 1 and 3 present the bass and treble potentiometers tuned to their highest values, respectively cutting off the high and low frequencies from the signal input. Figures 7 and 9 present the bass and treble potentiometers tuned to their lower values, passing far more high and low frequencies from the signal input. Figure 2 presents the level potentiometer tuned to its highest value increasing the gain of the circuit. This capture can be compared to Figure 8 which presents the level potentiometer tuned to its lowest value (peak-to-peak value of the signal increases from 1 Volt to 9.6 Volts as level increases). Figure 4 presents the mid potentiometer tuned to its highest value amplifying the center frequency of our input signal. A small amount of 'clipping' is noticable due to our mid-potentiometer exceeding the dynamic range of our two 250 kilaohm bass/treble potentiometers. Figures 5 and 6 present the level and mid potentiometers tuned to their respective 'half-way' marks. Each potentiometer had a clear effect on the signal input when driven through the class-D amplifier to our speakers.                                    </p>
                                            <p> We attempted to implement the digital portion of the tonestack through two separate methods. Our first implementation involved driving both the analog and digital potentiometers through a mux. The select signal for the mux was controlled via smartphone through a standard bluetooth interface. We decided to scrap this initial design due to the excessive amount of wiring required through the muxes, which made the mechanical construction of our guitar amplifier impractical. Our second implementation involved placing both the digital and analog potentiometers in parallel directly into the circuit. This design worked perfectly allowing the user to control the digital potentiometers across a much wider range due to the additional presence of the analog potentiometers. Once again, each potentiometer had a clear effect on the signal input when driven through the class-D amplifier to our speakers</p>
                                                
                                                <p>Unfortunately, 6 hours before our demonstration, an AC-DC transformer was accidentally connected to our digital potentiometer's power rail, resulting in a voltage spike that completely burned out all of the digital potentiometers, our protoboarded analog potentiometers, as well as our instrument's pickup. In order to present our work, we rewired 10 kilaohm digital potentiometers onto a breadboard. Each potentiometer is tunable through our bluetooth serial and can be driven through our class-D amplifier. Additionally, we rewired the analog potentiometers onto a separate breadboard, which could also be driven through our class-D amplifier. We expect that, once the 100 kilaohm digital potententiometers are rewired in parallel with the analog potentiometers, the entire tonestack will work as envisioned again.                              
                                            </p>
<h5> Digital Sound Effects</h5>
<p> The goal of the digital sound effects chip was to be able to play 16 different effect, at the choice of the user. The choice was made over a serial terminal on the bluetooth interface. By selecting numbers between 0 and 15, the user could hear various effects on a speaker. In order to test this chip, we tested changing effects, and viewing the effects on an oscilloscope. Figure 1 in the gallery is an image of a pure sinusoid before digital effects were applied. Figures 2 and 3, which are clearly different, show effects 3 and 12, respectively. Seeing these waveforms confirmed that the chip was working. In addition, using the ukulele as an input, we were able to hear various effects as outputs on the speaker. 
<p>During testing, there were various issues that occured with the sound effector chip. First of all, we were not able to see any output when using the schematic provided by the manufacturer. As a result, we decided to remove all active components in the schematic, and passively filter the output. This gave us the desired results. In addition, we decided to remove the left channel of the sound, as it was found to be unnecessary to hear desired outputs.</p>
    
<h5> Class D Amplifier</h5>
<p> The goal of the class D amplifier was to be able to drive sound through a 15 W -8 ohm speaker. Normal outputs did not have enough power to drive the speaker. The class D amplifier uses PWM based on the input waveform in order to output the correct waveform with enough power. When wiring the Class D amplifier, this led to a few problems. First, if output wasn't filtered correctly, loud clicks were visible in the waveform as well as in the sound. It was also difficult to test due to the pure volume of the sound  from the speaker. In addition, there were cases that even though there was an input, it would appear that the PWM was not functional. </p>
<p> In order to fix these issues, we first capacitively coupled the board with a 1 uF capacitor. This ensured that the PWM would work, as input power was smooth and consistent. Volume control was basd on the amount used as VCC. It is important to note that for the chip to function, this had to be at least 10 V. When the waveforms were viewed on the oscilloscope, after filtering of the PWM, outputs looked like all of the input waveforms, but with amplitude of approximately 5 V. The power from this was enough to drive the speakers with the desired outputs.</p>
                                    
<h5> Integration </h5>
<p> <span class="image right"><img src="images/InitialState.jpg" width=400px alt="" /></span> In integration, we hoped to have bluetooth control whether effects should come from the digital effects or distortion, both driven from output of the tonestack, or sound from just the tonestack. We were able to confirm that our multiplexer control of the circuit, with select signals from bluetooth, was able to select which input to drive the class D amplifier with. In addition, in develoopment, integration had completely worked before perfboarding the tonestack. However, after the aformentioned AC-DC spike, some parts failed, and integration had not worked. In addition, power may not have been consistent enough from an AC power supply to give the desired outputs. When outputs were reached, some appeared to be very noisy. Integration is a big goal for future improvements of this project. We hope to PCB all circuits and ensure consisency in integration</p>                                    
									
									<h4>Gallery</h4>
									<span class="image fit"><img src="images/banner2.png" alt="" /></span>
									<div class="box alt">
										<div class="row 50% uniform">
											<div class="4u"><span class="image fit"><img src="images/screen_cap/IMG_0279.jpg" alt="" /></span></div>
											<div class="4u"><span class="image fit"><img src="images/screen_cap/IMG_0281.jpg" alt="" /></span></div>
											<div class="4u"><span class="image fit"><img src="images/screen_cap/IMG_0282.jpg" alt="" /></span></div>
										</div>
										<div class="row 50% uniform">
											<div class="4u"><span class="image fit"><img src="images/screen_cap/high_bass.png" alt="" /></span></div>
											<div class="4u"><span class="image fit"><img src="images/screen_cap/high_level.png" alt="" /></span></div>
											<div class="4u"><span class="image fit"><img src="images/screen_cap/high_treble.png" alt="" /></span></div>
										</div>
										<div class="row 50% uniform">
											<div class="4u"><span class="image fit"><img src="images/screen_cap/mid_high.png" alt="" /></span></div>
											<div class="4u"><span class="image fit"><img src="images/screen_cap/mid_level.png" alt="" /></span></div>
											<div class="4u"><span class="image fit"><img src="images/screen_cap/mid_mid.png" alt="" /></span></div>
										</div>
										<div class="row 50% uniform">
											<div class="4u"><span class="image fit"><img src="images/screen_cap/no_bass.png" alt="" /></span></div>
											<div class="4u"><span class="image fit"><img src="images/screen_cap/no_level.png" alt="" /></span></div>
											<div class="4u"><span class="image fit"><img src="images/screen_cap/no_treble.png" alt="" /></span></div>
										</div>
									</div>
									</section>
								</div>
							</section>

						<!-- Five -->
						<!-- -->
							<section id="five">
								<div class="container">
								
										<h4>Parts List</h4>
										

										<h5>Alternate</h5>
										<div class="table-wrapper">
											<table class="alt">
												<thead>
													<tr>
														<th>Name</th>
														<th>Description</th>
														<th>Link</th>
														<th>Price</th>
													</tr>
												</thead>
												<tbody>
													<tr>
														<td>BTSE-16FX DSP Module</td>
														<td>This module provides 16 digital audio effects for our amplifier.</td>
														<td>https://www.tubesandmore.com/products/P-<br>RKBTSE-16FX</td>
														<td>$29.95</td>
													</tr>
													<tr>
														<td>Jensen MOD5-30 5” Guitar Speaker </td>
														<td>Speakers to amplify our sound</td>
														<td>http://www.amazon.com/Jensen-MOD5-30-Watt-<br>Guitar-Speaker/dp/B00346WOTC</td>
														<td>$29.50</td>
													</tr>
													<tr>
														<td>TI TPA3122D2 Class-D Amplifier chip</td>
														<td>Class-D Power Amplifier for speaker.</td>
														<td>https://octopart.com/tpa3122d2n-texas%2B<br>instruments-11912477</td>
														<td>$2.53</td>
													</tr>
													<tr>
														<td>3 100kOhm Digital Potentiometers</td>
														<td>Digital control over resistance in tonestack circuit.</td>
														<td>http://www.digikey.com/product-detail/en/MCP4131<br>-104E%2FP/MCP4131-104E%2FP-ND/1874342</td>
														<td>$.67 (x3)</td>
													</tr>
													<tr>
														<td>HC0-5 Wireless Transceiver Module</td>
														<td>This module was part of our ‘stretch goal’ to add bluetooth connectivity.</td>
														<td>http://www.ebay.com/itm/like/351558451893?ul<br>_noapp=true&chn=ps&lpid=82</td>
														<td>$3.76</td>
													</tr>
													<tr>
														<td>Microstick II</td>
														<td>For programming and temporarily mounting the Pic32.</td>
														<td>http://www.microchip.com/Developmenttools/<br>ProductDetails.aspx?PartNO=DM330013-2</td>
														<td>$10 Rental</td>
													</tr>
													<tr>
														<td>Breadboard</td>
														<td>Temporary mounting of circuit components.</td>
														<td>N/A Rental</td>
														<td>$6 (x2)</td>
													</tr>
													<tr>
														<td>Protoboard</td>
														<td>Permanent mounting of circuit components.</td>
														<td>N/A</td>
														<td>$2.50 (x2)</td>
													</tr>
												</tbody>
												<tfoot>
													<tr>
														<td colspan="3"></td>
														<td>$94.75</td>
													</tr>
												</tfoot>
											</table>
										</div>
								</div>
						</section>
				
						<section id="six">
							<div class="container">
								<h3>Conclusions</h3>
								<p> There are a few key improvements that we aim to make to our guitar amplifier in the future. First of all, we aim to replace our 250 kilaohm bass and treble potentiometers with 500 kilaohm potentiometers within our analog tonestack. This should allow for more significant effects by changing our cutoff frequency range as well as prevent any possible clipping at our output. Secondly, we aim to rewire our 100 kilaohm digital potentiometers in parallel with our analog potentiometers to achieve our digital/analog switch capabilities. </p>
							</div>		
						</section>

						<section>
							<div class="container">
								<h3>Appendix</h3>
								<ul class="actions">
									<li><a href="code.html"><input type="submit" class="special" value="Code"></a></li>
								</ul>
							</div>
						</section>
				
					<section>
						<div class="container">
							<h3>Sources</h3>
							<ul>
								<li><a href="">www.example.com</a></li>
								<li><a href="">Ben Jerry's Research</a></li>
							</ul>
						</div>
					</section>

				<!-- Footer -->
					<section id="footer">
						<div class="container">
							<ul class="copyright">
								<li>&copy; Untitled. All rights reserved.</li><li>Designed by <a href="http://www.justin-selig.com">Justin Selig</a></li>
							</ul>
						</div>
					</section>

			</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.scrollzer.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/skel.min.js"></script>
			<script src="assets/js/util.js"></script>
			<!--[if lte IE 8]><script src="assets/js/ie/respond.min.js"></script><![endif]-->
			<script src="assets/js/main.js"></script>

	</body>
</html>